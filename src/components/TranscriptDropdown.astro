---
import transcriptScript from '../scripts/transcript.ts?url';

interface Props {
  subtitleUrl?: string | undefined;
  podcastTitle: string;
}

const { subtitleUrl, podcastTitle } = Astro.props as Props;
---

{
  subtitleUrl && (
    <section
      class="transcript"
      aria-labelledby="transcript-title"
      data-subtitle-url={subtitleUrl}
      data-podcast-title={podcastTitle}
      data-player-id={subtitleUrl}
    >
      <details class="transcript__details">
        <summary class="transcript__summary">
          <span class="transcript__summary-title" id="transcript-title">
            ðŸ“„ Transcript
          </span>
          <span class="transcript__summary-hint">Show Transcript</span>
        </summary>
        <div class="transcript__body">
          <p class="transcript__status transcript__status--loading" hidden>
            Loading transcript...
          </p>
          <p class="transcript__status transcript__status--error" hidden>
            Error loading transcript
          </p>
          <div class="transcript__content" hidden />
        </div>
      </details>
    </section>
  )
}

<script type="module" src={transcriptScript}></script>

<style>
  .transcript {
    margin-block-start: 2rem;
    background: var(--color-layer-4);
    border: 1px solid color-mix(in srgb, var(--color-primary) 28%, transparent);
    border-radius: 1rem;
    box-shadow: var(--shadow-soft);
  }

  .transcript__summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    cursor: pointer;
    list-style: none;
    background: var(--color-layer-3);
    border-radius: 1rem 1rem 0 0;
  }

  .transcript__summary::-webkit-details-marker {
    display: none;
  }

  .transcript__summary:focus-visible {
    outline: none;
    border-radius: 0.5rem;
    box-shadow: var(--focus-ring);
  }

  .transcript__summary-title {
    font-weight: 700;
    color: var(--color-text);
  }

  .transcript__summary-hint {
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  .transcript__body {
    padding: 1rem 1.25rem 1.25rem;
    border-block-start: 1px solid color-mix(in srgb, var(--color-primary) 24%, transparent);
  }

  .transcript__status {
    margin: 0 0 0.75rem;
    color: var(--color-text-muted);
  }

  .transcript__status--error {
    color: var(--color-error-soft);
  }

  .transcript__content {
    display: grid;
    gap: 0.75rem;
    max-block-size: 24rem;
    padding-inline-end: 0.25rem;
    overflow-block: auto;
  }

  :global(.transcript .transcript__cue) {
    display: grid;
    grid-template-columns: minmax(3.5rem, auto) 1fr;
    gap: 0.75rem;
    align-items: start;
    inline-size: 100%;
    padding: 0.85rem 1rem;
    margin: 0;
    font: inherit;
    line-height: 1.65;
    color: var(--color-text);
    text-align: start;
    appearance: none;
    cursor: pointer;
    background: var(--color-layer-2);
    border: 1px solid color-mix(in srgb, var(--color-primary) 22%, transparent);
    border-radius: 0.85rem;
  }

  :global(.transcript .transcript__cue:focus-visible) {
    outline: none;
    box-shadow: var(--focus-ring);
  }

  :global(.transcript .transcript__cue--active) {
    background: color-mix(in srgb, var(--color-primary) 18%, var(--color-layer-2));
    border-color: color-mix(in srgb, var(--color-primary) 55%, transparent);
  }

  :global(.transcript .transcript__time) {
    display: inline-block;
    min-inline-size: 3.5rem;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    color: var(--color-primary);
    text-align: end;
  }

  :global(.transcript .transcript__text) {
    color: var(--color-text);
  }

  @supports not (color-mix(in srgb, #000 50%, transparent)) {
    .transcript {
      border-color: rgb(111 225 255 / 32%);
    }

    .transcript__body {
      border-block-start-color: rgb(111 225 255 / 28%);
    }

    :global(.transcript .transcript__cue) {
      border-color: rgb(111 225 255 / 28%);
    }

    :global(.transcript .transcript__cue--active) {
      border-color: rgb(111 225 255 / 60%);
    }
  }
</style>
