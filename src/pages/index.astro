---
import PodcastLayout from "../layouts/PodcastLayout.astro";
import SearchBar from "../components/SearchBar.astro";
import EpisodeCard from "../components/EpisodeCard.astro";
import type { PodcastData } from "../types/podcast";

import enPodcasts from "../data/podcasts/en.json";

const podcasts = (enPodcasts.podcasts as PodcastData[]).filter(
  (podcast) => podcast.isAvailable,
);

const t = {
  title: "MelodyMind Podcasts",
  subtitle: "Feel-good music journeys with Daniel & Annabelle",
  description:
    "Settle in, press play, and wander through the stories behind the songs. Daniel & Annabelle take you from vinyl crackle to streaming sheen ‚Äî meeting rebels, dreamers, and legends along the way. No dusty archive: just warm, human stories, surprising facts, and playlists you‚Äôll want to save.",
  seoDescription:
    "Discover music history through expert podcasts. Explore decades of musical evolution, from 1950s rock 'n' roll to modern streaming. Premium audio content featuring legendary artists, cultural movements, and industry insights.",
  episodes: "Episodes",
  listen: "Listen Now",
  featuredContent:
    "Discover the voices, rhythms, and revolutions that defined generations",
  totalEpisodes: " episodes available",
  availableOn: "Available on your favorite platforms:",
  spotifyUrl: "https://open.spotify.com/show/6iLbxIzJ4x5nMuuK5qySOQ",
  deezerUrl: "https://www.deezer.com/en/show/1002446242",
  youtubeUrl:
    "https://www.youtube.com/playlist?list=PLioOQ4LuNFxtx2d70QKywiPC8WVBxgXN0",
  keywords: [
    "music history podcast",
    "rock and roll",
    "music culture",
    "vintage music",
    "music documentary",
    "audio stories",
  ],
};
---

<PodcastLayout
  title={t.title}
  description={t.seoDescription}
  keywords={t.keywords}
  type="website"
  language="en"
  locale="en-US"
  seriesDescription={t.seoDescription}
>
  <div class="home">
    <section class="home__hero">
      <div class="home__hero-inner">
        <div class="home__badges">
          <span class="home__badge">üéôÔ∏è Sound-rich storytelling</span>
          <span class="home__badge">Warm studio vibes, hi-fi polish</span>
        </div>

        <div class="home__intro">
          <h1 class="home__title">{t.title}</h1>
          <p class="home__subtitle">{t.subtitle}</p>
          <p class="home__description">{t.description}</p>
        </div>

        <div class="home__media">
          <img
            src="/the-melody-mind-podcast.jpg"
            alt="Illustrated cover art"
            class="home__image"
            loading="lazy"
            decoding="async"
          />
          <span class="home__media-label">üîÜ Analog glow, hi-fi clarity</span>
        </div>

        <div class="home__highlights">
          <div class="home__highlight">
            <span aria-hidden="true">üéß</span>
            <span>
              New episodes perfect for a walk, commute, or cozy night in.
            </span>
          </div>
          <div class="home__highlight">
            <span aria-hidden="true">‚ú®</span>
            <span>
              Stories first, facts second: always warm, curious, and welcoming.
            </span>
          </div>
          <div class="home__highlight home__highlight--wide">
            <span aria-hidden="true">üé∂</span>
            <span>
              From rock ‚Äôn‚Äô roll sparks to electronic fireworks ‚Äî hear how music became the soundtrack of our lives.
            </span>
          </div>
        </div>

        <div class="home__cta-row">
          <a href="#episodes-heading" class="home__cta home__cta--primary">
            Browse episodes
          </a>
          <a href="/rss.xml" class="home__cta home__cta--secondary" aria-label="Subscribe to RSS feed">
            RSS feed
          </a>
        </div>

        <div class="home__platforms">
          <span class="home__platforms-label">{t.availableOn}</span>
          <div class="home__platforms-row">
            <a
              href={t.spotifyUrl}
              class="home__platform-link"
              aria-label="Listen on Spotify"
              target="_blank"
              rel="noopener"
            >
              Spotify
            </a>
            <a
              href={t.deezerUrl}
              class="home__platform-link"
              aria-label="Listen on Deezer"
              target="_blank"
              rel="noopener"
            >
              Deezer
            </a>
          </div>
        </div>

        <div class="home__meta">
          <span class="home__meta-item">
            {podcasts.length}
            {t.totalEpisodes}
          </span>
          <span class="home__meta-item">
            {t.featuredContent}
          </span>
        </div>
      </div>
    </section>

    <SearchBar total={podcasts.length} />

    <section class="home__episodes" aria-labelledby="episodes-heading">
      <h2 id="episodes-heading" class="home__section-title">
        {t.episodes}
      </h2>

      <div
        class="home__episodes-grid"
        role="list"
        id="episodes-list"
      >
        {
          podcasts.map((podcast) => (
            <EpisodeCard
              id={podcast.id}
              title={podcast.title}
              description={podcast.description}
              imageUrl={podcast.imageUrl}
              durationSeconds={podcast.durationSeconds}
              searchText={`${podcast.title} ${podcast.description}`}
            />
          ))
        }
      </div>
    </section>
  </div>

  <script is:inline>
    (() => {
      const form = document.querySelector(".search-bar");
      if (!form) return;

      const input = form.querySelector(".search-bar__input");
      const clearButton = form.querySelector(".search-bar__clear");
      const status = form.querySelector("#search-status");
      const empty = form.querySelector("#search-empty");
      const items = Array.from(document.querySelectorAll("[data-episode]"));

      const normalize = (value) => value.trim().toLowerCase();

      const updateStatus = (count) => {
        if (status) {
          const total = status.getAttribute("data-total") || "0";
          const word = count === 1 ? "result" : "results";
          status.textContent = `Found: ${count} of ${total} ${word}`;
        }
        if (empty) {
          empty.hidden = count !== 0;
        }
      };

      const filter = (value) => {
        const query = normalize(value);
        let shown = 0;

        if (!query) {
          items.forEach((el) => {
            if (el instanceof HTMLElement) {
              el.hidden = false;
              el.setAttribute("tabindex", "0");
              el.setAttribute("aria-hidden", "false");
            }
          });
          shown = items.length;
        } else {
          items.forEach((el) => {
            const hay = normalize(el.getAttribute("data-search") || "");
            const match = hay.includes(query);
            if (el instanceof HTMLElement) {
              el.hidden = !match;
              if (match) {
                shown += 1;
                el.setAttribute("tabindex", "0");
                el.setAttribute("aria-hidden", "false");
              } else {
                el.removeAttribute("tabindex");
                el.setAttribute("aria-hidden", "true");
              }
            }
          });
        }

        updateStatus(shown);
      };

      form.addEventListener("submit", (event) => event.preventDefault());

      input?.addEventListener("input", (event) => {
        filter(event.target.value);
      });

      clearButton?.addEventListener("click", () => {
        if (input instanceof HTMLInputElement) {
          input.value = "";
          input.focus();
          filter("");
        }
      });

      updateStatus(items.length);
    })();
  </script>
</PodcastLayout>

<style>
  .home {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  .home__hero {
    position: relative;
    padding: 3rem 2rem;
    border-radius: 2rem;
    background: var(--color-surface);
    border: 1px solid color-mix(in srgb, var(--color-primary) 20%, transparent);
    box-shadow: var(--shadow-soft);
    overflow: hidden;
  }

  .home__hero::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 18% 22%, rgba(246, 193, 119, 0.08), transparent 35%),
      radial-gradient(circle at 82% 12%, rgba(122, 203, 191, 0.08), transparent 32%),
      radial-gradient(circle at 70% 68%, rgba(255, 149, 128, 0.05), transparent 38%);
    opacity: 0.8;
  }

  .home__hero-inner {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 2rem;
    text-align: center;
    align-items: center;
  }

  .home__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
  }

  .home__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.45rem 0.9rem;
    border-radius: 999px;
    background: var(--color-layer-2);
    border: 1px solid color-mix(in srgb, var(--color-primary) 20%, transparent);
    color: var(--color-text);
    font-size: 0.9rem;
  }

  .home__intro {
    display: grid;
    gap: 0.75rem;
    max-width: 48rem;
  }

  .home__title {
    margin: 0;
    font-size: 2.6rem;
    font-weight: 800;
    background: var(--brand-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 18px 40px rgba(0, 0, 0, 0.4);
  }

  .home__subtitle {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .home__description {
    margin: 0;
    font-size: 1.05rem;
    color: var(--color-text-muted);
    line-height: 1.6;
  }

  .home__media {
    position: relative;
    width: 100%;
    max-width: 40rem;
  }

  .home__image {
    width: 100%;
    height: auto;
    border-radius: 1.6rem;
    border: 1px solid color-mix(in srgb, var(--color-primary) 25%, transparent);
    box-shadow: var(--shadow-strong);
    display: block;
  }

  .home__media-label {
    position: absolute;
    right: 1rem;
    top: 1rem;
    font-size: 0.75rem;
    padding: 0.35rem 0.7rem;
    border-radius: 999px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .home__highlights {
    display: grid;
    gap: 1rem;
    width: 100%;
    max-width: 48rem;
  }

  .home__highlight {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
    padding: 1rem 1.1rem;
    border-radius: 1rem;
    background: var(--color-layer-1);
    border: 1px solid color-mix(in srgb, var(--color-primary) 20%, transparent);
    color: var(--color-text);
    box-shadow: var(--shadow-soft);
  }

  .home__highlight--wide {
    grid-column: 1 / -1;
  }

  .home__cta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
  }

  .home__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.4rem;
    border-radius: 0.9rem;
    font-size: 0.95rem;
    font-weight: 700;
    text-decoration: none;
  }

  .home__cta--primary {
    background: var(--color-primary);
    color: var(--color-background);
    box-shadow: var(--shadow-strong);
  }

  .home__cta--secondary {
    background: var(--color-layer-1);
    border: 1px solid color-mix(in srgb, var(--color-primary) 25%, transparent);
    color: var(--color-text);
  }

  .home__cta:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
  }

  .home__platforms {
    display: grid;
    gap: 0.75rem;
    justify-items: center;
  }

  .home__platforms-label {
    color: var(--color-text-muted);
    font-weight: 600;
    font-size: 0.9rem;
  }

  .home__platforms-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
  }

  .home__platform-link {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border-radius: 999px;
    background: var(--color-layer-1);
    border: 1px solid color-mix(in srgb, var(--color-primary) 25%, transparent);
    color: var(--color-text);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
  }

  .home__platform-link:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
  }

  .home__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
    color: var(--color-text);
    font-size: 0.9rem;
  }

  .home__meta-item {
    padding: 0.5rem 0.9rem;
    border-radius: 0.9rem;
    background: var(--color-layer-2);
    border: 1px solid color-mix(in srgb, var(--color-primary) 20%, transparent);
    box-shadow: var(--shadow-soft);
  }

  .home__episodes {
    display: grid;
    gap: 1.5rem;
  }

  .home__section-title {
    margin: 0;
    font-size: 1.75rem;
    font-weight: 800;
    background: var(--brand-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .home__episodes-grid {
    display: grid;
    gap: 1.25rem;
  }

  @media (min-width: 768px) {
    .home__episodes-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (min-width: 1200px) {
    .home__episodes-grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>
