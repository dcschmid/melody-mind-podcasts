---
const { total } = Astro.props as { total: number };

const labels = {
  placeholder: "Search episodes",
  label: "Search episodes",
  results: "results",
  resultOne: "result",
  clear: "Clear search",
  hint: "Type to filter episodes. Matches title & description.",
  empty: "No matching episodes.",
  statusTemplate: "Found: {found} of {total} {word}",
};
---
<form
  role="search"
  class="search-bar"
  aria-label={labels.label}
  aria-controls="episodes-list"
>
  <div class="search-bar__row">
    <div class="search-bar__field">
      <label for="episode-search" class="search-bar__label search-bar__label--visually-hidden">
        {labels.label}
      </label>
      <input
        id="episode-search"
        name="q"
        type="search"
        inputmode="search"
        autocomplete="off"
        placeholder={labels.placeholder}
        aria-describedby="search-hint"
        aria-live="polite"
        class="search-bar__input"
      />
      <button
        type="button"
        aria-label={labels.clear}
        class="search-bar__clear"
      >
        Ã—
      </button>
    </div>
  </div>
  <p id="search-hint" class="search-bar__hint" aria-hidden="true">
    {labels.hint}
  </p>
  <div
    aria-live="polite"
    aria-atomic="true"
    id="search-status"
    class="search-bar__status"
    data-total={total}
  >
    {labels.statusTemplate
      .replace("{found}", String(total))
      .replace("{total}", String(total))
      .replace("{word}", total === 1 ? labels.resultOne : labels.results)}
  </div>
  <div
    id="search-empty"
    class="search-bar__empty"
    role="status"
    hidden
  >
    {labels.empty}
  </div>
</form>

<style>
  .search-bar {
    width: min(100%, 68rem);
    margin: 0 auto 3rem;
    display: grid;
    gap: 0.85rem;
  }

  .search-bar__row {
    display: grid;
    padding: 0.55rem;
    border-radius: 1.25rem;
    border: 1px solid color-mix(in srgb, var(--color-primary) 22%, transparent);
    background: linear-gradient(
      150deg,
      color-mix(in srgb, var(--color-layer-2) 92%, transparent),
      color-mix(in srgb, var(--color-layer-1) 96%, transparent)
    );
    box-shadow:
      0 20px 44px rgba(2, 8, 18, 0.45),
      0 0 0 1px rgba(120, 200, 255, 0.08);
  }

  .search-bar__field {
    position: relative;
    width: 100%;
    border-radius: 0.95rem;
    border: 1px solid color-mix(in srgb, var(--color-primary) 18%, transparent);
    background: color-mix(in srgb, var(--color-layer-1) 92%, transparent);
    box-shadow: inset 0 0 0 1px rgba(10, 18, 32, 0.35);
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .search-bar__field:focus-within {
    border-color: var(--color-primary);
    box-shadow: var(--focus-ring);
  }

  .search-bar__label--visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }

  .search-bar__input {
    width: 100%;
    padding: 0.95rem 2.75rem 0.95rem 1.2rem;
    border-radius: 0.9rem;
    border: none;
    background: transparent;
    color: var(--color-text);
    font-size: 1.05rem;
  }

  .search-bar__input::placeholder {
    color: var(--color-text-muted);
  }

  .search-bar__input:focus-visible {
    outline: none;
  }

  .search-bar__clear {
    position: absolute;
    right: 0.55rem;
    top: 50%;
    transform: translateY(-50%);
    border: 1px solid color-mix(in srgb, var(--color-primary) 18%, transparent);
    background: var(--color-layer-2);
    color: var(--color-text);
    font-size: 1.05rem;
    line-height: 1;
    width: 2.05rem;
    height: 2.05rem;
    border-radius: 999px;
    display: grid;
    place-items: center;
    cursor: pointer;
    transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
  }

  .search-bar__clear:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
  }

  .search-bar__clear:hover {
    transform: translateY(-50%) scale(1.03);
    border-color: color-mix(in srgb, var(--color-primary) 45%, transparent);
    box-shadow: 0 10px 18px rgba(2, 8, 18, 0.35);
  }

  .search-bar__hint {
    margin: 0;
    font-size: 0.9rem;
    color: var(--color-text-muted);
  }

  .search-bar__status {
    margin: 0;
    font-size: 0.95rem;
    color: var(--color-primary);
  }

  .search-bar__empty {
    margin: 0;
    font-size: 0.95rem;
    color: var(--color-error-soft);
  }
</style>
