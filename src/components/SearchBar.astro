---
const { total } = Astro.props as { total: number };

const labels = {
  placeholder: "Search episodes",
  label: "Search episodes",
  results: "results",
  resultOne: "result",
  clear: "Clear search",
  hint: "Type to filter episodes. Matches title & description.",
  empty: "No matching episodes.",
  statusTemplate: "Found: {found} of {total} {word}",
};
---
<form
  role="search"
  class="search-bar"
  aria-label={labels.label}
  aria-controls="episodes-list"
>
  <div class="search-bar__row">
    <div class="search-bar__field">
      <label for="episode-search" class="search-bar__label search-bar__label--visually-hidden">
        {labels.label}
      </label>
      <input
        id="episode-search"
        name="q"
        type="search"
        inputmode="search"
        autocomplete="off"
        placeholder={labels.placeholder}
        aria-describedby="search-hint"
        aria-live="polite"
        class="search-bar__input"
      />
      <button
        type="button"
        aria-label={labels.clear}
        class="search-bar__clear"
      >
        Ã—
      </button>
    </div>
  </div>
  <p id="search-hint" class="search-bar__hint" aria-hidden="true">
    {labels.hint}
  </p>
  <div
    aria-live="polite"
    aria-atomic="true"
    id="search-status"
    class="search-bar__status"
    data-total={total}
  >
    {labels.statusTemplate
      .replace("{found}", String(total))
      .replace("{total}", String(total))
      .replace("{word}", total === 1 ? labels.resultOne : labels.results)}
  </div>
  <div
    id="search-empty"
    class="search-bar__empty"
    role="status"
    hidden
  >
    {labels.empty}
  </div>
</form>

<style>
  .search-bar {
    max-width: 40rem;
    margin: 0 auto 2.5rem;
  }

  .search-bar__row {
    display: flex;
  }

  .search-bar__field {
    position: relative;
    width: 100%;
  }

  .search-bar__label--visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }

  .search-bar__input {
    width: 100%;
    padding: 0.85rem 2.5rem 0.85rem 1rem;
    border-radius: 0.85rem;
    border: 1px solid color-mix(in srgb, var(--color-primary) 25%, transparent);
    background: var(--color-layer-1);
    color: var(--color-text);
    font-size: 1rem;
    box-shadow: var(--shadow-soft);
  }

  .search-bar__input::placeholder {
    color: var(--color-text-muted);
  }

  .search-bar__input:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
    border-color: var(--color-primary);
  }

  .search-bar__clear {
    position: absolute;
    right: 0.6rem;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: transparent;
    color: var(--color-text-muted);
    font-size: 1.25rem;
    line-height: 1;
    padding: 0.1rem 0.35rem;
    border-radius: 0.35rem;
    cursor: pointer;
  }

  .search-bar__clear:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
  }

  .search-bar__hint {
    margin: 0.6rem 0 0;
    font-size: 0.85rem;
    color: var(--color-text-muted);
  }

  .search-bar__status {
    margin: 0.6rem 0 0;
    font-size: 0.95rem;
    color: var(--color-primary);
  }

  .search-bar__empty {
    margin: 0.6rem 0 0;
    font-size: 0.95rem;
    color: var(--color-error-soft);
  }
</style>
